# v0.2.0 PR Checklist (LOCKED)

> Scope: this checklist is intentionally implementation-specific. Every item maps to concrete file edits and exact test additions.

> Note: v0.3 cleanup validation now lives in `V0.3.0_PR_CHECKLIST.md` (canonical-only imports + removal-state consistency).

## 1) Package/API hardening

### Files to change
- `temporal_gradient/__init__.py`
  - Export a stable top-level API surface (`__all__`) for `clock`, `memory`, `salience`, `telemetry`, and `load_config`.
  - Add `__version__ = "0.2.0"`.
- `temporal_gradient/contracts/__init__.py`
  - Ensure contract symbols are explicitly re-exported via `__all__`.
- `README.md`
  - Update Status section to `Current Version: 0.2.0`.
  - Add a short "API Stability (v0.2.x)" note listing stable import paths.

### Exact tests to add
- `tests/test_package_api.py`
  - `test_top_level_exports_are_present()`
    - `import temporal_gradient as tg`
    - Assert attributes exist: `clock`, `memory`, `salience`, `telemetry`, `load_config`.
  - `test_package_version_is_0_2_0()`
    - Assert `temporal_gradient.__version__ == "0.2.0"`.
  - `test_contracts_all_contains_protocols()`
    - Import `temporal_gradient.contracts as c`
    - Assert required protocol names are in `c.__all__`.

---

## 2) Config validation tightening

### Files to change
- `temporal_gradient/config.py`
  - Enforce unknown-key rejection at both top-level and nested sections.
  - Validate numeric bounds:
    - `clock.base_dilation_factor > 0`
    - `clock.min_clock_rate in (0, 1]`
    - `memory.decay_lambda >= 0`
    - `memory.s_max > 0`
  - Normalize config by returning a fully-populated dict including defaults.
- `tg.yaml`
  - Keep as canonical example matching the strict schema.

### Exact tests to add
- `tests/test_config_loader_strictness.py`
  - `test_load_config_rejects_unknown_top_level_key(tmp_path)`
  - `test_load_config_rejects_unknown_nested_clock_key(tmp_path)`
  - `test_load_config_rejects_invalid_min_clock_rate(tmp_path)` with values `0`, `-0.1`, `1.5`.
  - `test_load_config_rejects_negative_decay_lambda(tmp_path)`.
  - `test_load_config_returns_defaulted_structure(tmp_path)` ensuring omitted optional keys are filled.

---

## 3) Clock behavior edge-case guarantees

### Files to change
- `temporal_gradient/clock/chronos.py`
  - Guarantee deterministic behavior for pathological `psi` values:
    - `nan`/`inf` handling policy (raise `ValueError` preferred).
    - Clamp negative `psi` to `0.0` before rate computation.
  - Keep strict-mode checks consistent between `clock_rate_from_psi()` and `tick()`.

### Exact tests to add
- `tests/test_clock_edge_cases.py`
  - `test_clock_rate_from_psi_clamps_negative_psi_to_zero()`.
  - `test_clock_rate_from_psi_rejects_non_finite_values()` parameterized with `math.nan`, `math.inf`, `-math.inf`.
  - `test_tick_rejects_non_finite_psi()`.
  - `test_tick_and_rate_validation_are_consistent_in_strict_mode()`.

---

## 4) Memory store invariants

### Files to change
- `temporal_gradient/memory/store.py`
  - Enforce invariant `0 <= strength <= s_max` at write/update boundaries.
  - Validate monotonicity expectation for `last_tau` per key (reject regressions unless explicit override flag).
  - Add helper for deterministic prune decisions based on threshold.
- `temporal_gradient/memory/decay.py`
  - Ensure decay/apply functions never output tiny negative floats due to precision; floor at `0.0`.

### Exact tests to add
- `tests/test_memory_store_invariants.py`
  - `test_upsert_rejects_strength_above_s_max()`.
  - `test_upsert_rejects_negative_strength()`.
  - `test_upsert_rejects_last_tau_regression_for_same_key()`.
  - `test_prune_uses_threshold_rule_exactly()`.
- `tests/test_entropic_decay_precision.py`
  - `test_decay_floors_negative_epsilon_to_zero()`.

---

## 5) Telemetry schema compatibility and coercion policy

### Files to change
- `temporal_gradient/telemetry/schema.py`
  - Document and enforce required keys versus optional keys.
  - Pick one coercion strategy and enforce consistently (recommended: no silent coercion, explicit numeric types only).
- `temporal_gradient/telemetry/chronometric_vector.py`
  - Align packet emission with strict schema contract.

### Exact tests to add
- `tests/test_telemetry_schema_strictness.py`
  - `test_validate_packet_rejects_missing_required_fields()`.
  - `test_validate_packet_rejects_wrong_types_without_coercion()`.
  - `test_validate_packet_accepts_minimal_valid_packet()`.
  - `test_chronometric_vector_to_packet_matches_schema()`.

---

## 6) Salience pipeline determinism and bounds

### Files to change
- `temporal_gradient/salience/pipeline.py`
  - Bound outputs to `[0, 1]` for novelty/value where applicable.
  - Ensure `psi = novelty * value` is reproducible for identical input sequence.
  - Clarify tokenization behavior for empty strings and punctuation-only strings.

### Exact tests to add
- `tests/test_salience_pipeline_determinism.py`
  - `test_pipeline_is_deterministic_for_identical_input_sequence()`.
  - `test_pipeline_handles_empty_input_with_zero_or_defined_bounds()`.
  - `test_pipeline_handles_punctuation_only_input()`.
  - `test_pipeline_outputs_are_bounded_between_zero_and_one()`.

---

## 7) Harness regression protection

### Files to change
- `sanity_harness.py`
  - Keep machine-readable summary mode stable (if present, preserve key names).
- `calibration_harness.py`
  - Ensure config-driven execution paths are deterministic under fixed input.

### Exact tests to add
- `tests/test_harness_regressions_v020.py`
  - `test_sanity_harness_outputs_stable_summary_shape(capsys)`.
  - `test_calibration_harness_deterministic_given_fixed_inputs(tmp_path, capsys)`.

---

## 8) CI and release controls

### Files to change
- `.github/workflows/pytest.yml`
  - Add Python version matrix (e.g., `3.10`, `3.11`, `3.12`).
  - Add explicit `pytest -q` step and fail-fast disabled for full signal.
- `README.md`
  - Add testing command section matching CI command.

### Exact tests/checks to add
- No new pytest file required; CI job itself is the check.
- Required CI commands for v0.2.0 PR:
  - `pytest -q`
  - `python -m pytest tests/test_config_loader_strictness.py -q`
  - `python -m pytest tests/test_clock_edge_cases.py -q`

---

## Definition of Done (v0.2.0)
- [ ] All file edits above are implemented.
- [ ] All newly listed tests are added with exact names.
- [ ] Full test suite passes locally.
- [ ] `README.md` version/status updated to 0.2.0.
- [ ] CI workflow runs full matrix and passes.
- [ ] PR description links this checklist and marks each section complete.

## Lock Notes
- This checklist is **LOCKED** for scope control.
- Any change to checklist items requires a separate maintainer-approved PR.
